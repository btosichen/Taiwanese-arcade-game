<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Little Mary Arcade - Â∞èÁë™Ëéâ</title>
    <style>
        /* --- CSS STYLES --- */
        :root {
            --bg-color: #1a1a1a;
            --board-bg: #2c3e50;
            --led-off: #444;
            --led-on: #f00;
            --accent: #f1c40f;
            --text-color: #fff;
            --neon-green: #39ff14;
            --neon-pink: #ff007f;
        }

        body {
            background-color: #000;
            color: var(--text-color);
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
        }

        /* Game Cabinet Container */
        .cabinet {
            background-color: var(--bg-color);
            border: 4px solid #555;
            border-radius: 15px;
            padding: 15px;
            width: 95%;
            max-width: 600px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            position: relative;
        }

        /* Header / Scoreboard */
        .scoreboard {
            display: flex;
            justify-content: space-between;
            background: #000;
            border: 2px solid #777;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .score-box {
            text-align: center;
            width: 30%;
        }

        .score-label {
            font-size: 0.8rem;
            color: #aaa;
            margin-bottom: 4px;
        }

        .score-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--neon-green);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-shadow: 0 0 5px var(--neon-green);
        }

        #win-display { color: var(--neon-pink); text-shadow: 0 0 5px var(--neon-pink); }

        /* Main Board - The Loop */
        .game-board {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(7, 1fr);
            gap: 4px;
            aspect-ratio: 1/1;
            background-color: #000;
            padding: 5px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .slot {
            background-color: var(--board-bg);
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            position: relative;
            border: 2px solid #444;
            transition: all 0.1s;
        }

        .slot.active {
            background-color: #fff;
            border-color: var(--led-on);
            box-shadow: 0 0 15px var(--led-on) inset, 0 0 10px var(--led-on);
            transform: scale(1.05);
            z-index: 10;
        }

        .slot span.icon { font-size: 1.4rem; }
        .slot span.mult { font-size: 0.6rem; color: #ffd700; margin-top: 2px; }

        /* Center Panel (Inside the loop) */
        .center-panel {
            grid-column: 2 / span 5;
            grid-row: 2 / span 5;
            background: #222;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            border: 2px dashed #444;
        }

        .center-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 #000;
        }

        .message-log {
            font-size: 0.9rem;
            color: #fff;
            min-height: 40px;
            background: rgba(0,0,0,0.5);
            width: 90%;
            padding: 5px;
            border-radius: 4px;
        }

        /* Control Panel */
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Betting Buttons */
        .bet-panel {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            background: #333;
            padding: 10px;
            border-radius: 8px;
        }

        .bet-btn {
            background: linear-gradient(to bottom, #e67e22, #d35400);
            border: none;
            border-radius: 5px;
            padding: 8px 2px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 4px 0 #a04000;
            active: translateY(2px);
        }

        .bet-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #a04000;
        }

        .bet-btn .bet-icon { font-size: 1.2rem; }
        .bet-btn .bet-amount { font-size: 0.8rem; color: #fff; background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 10px; margin-top: 2px;}

        /* Main Action Buttons */
        .action-row {
            display: flex;
            gap: 10px;
            height: 50px;
        }

        .btn-action {
            border: none;
            border-radius: 8px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            flex: 1;
            text-transform: uppercase;
            box-shadow: 0 4px 0 rgba(0,0,0,0.5);
            transition: transform 0.1s;
        }

        .btn-action:active { transform: translateY(4px); box-shadow: none; }

        .btn-red { background: #c0392b; }
        .btn-green { background: #27ae60; }
        .btn-blue { background: #2980b9; font-size: 1.2rem; flex: 2; }

        /* Double Up Modal */
        #double-modal {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none; /* Hidden by default */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            border-radius: 12px;
        }

        .modal-content {
            text-align: center;
            color: white;
        }

        .big-number {
            font-size: 5rem;
            font-weight: bold;
            color: var(--accent);
            margin: 20px 0;
            min-height: 100px;
        }

        .double-btns {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .d-btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            border: none;
            cursor: pointer;
            border-radius: 8px;
            font-weight: bold;
        }

        @media (max-width: 400px) {
            .cabinet { padding: 5px; width: 98%; }
            .slot span.icon { font-size: 1rem; }
            .score-value { font-size: 1.1rem; }
        }
    </style>
</head>
<body>

    <!-- Game Information Comment Block -->
    <!-- 
        ÈÅäÊà≤Ë¶èÂâá / Game Rules:
        1. 1 Credit = 10 NTD (Simulated).
        2. Betting: Use orange buttons to bet on specific symbols.
        3. Payout: If the light stops on your symbol, Win = Bet * Multiplier.
        
        Multipliers / ÂÄçÁéáË°®:
        - Apple / ËòãÊûú: 5x
        - Orange / Ê©òÂ≠ê: 10x
        - Bell / ÈáëÈêò: 10x
        - Lemon / Ê™∏Ê™¨: 15x
        - Star / ÊòüÊòü: 15x
        - Watermelon / Ë•øÁìú: 20x
        - 77: 20x
        - BAR: 100x (Highest / ÊúÄÈ´ò)

        Double or Nothing / ÊØîÂ§ßÂ∞è:
        - Range 1-10.
        - Small (Â∞è): 1-5
        - Big (Â§ß): 6-10
        - Win: Prize x 2
        - Lose: Prize = 0
    -->

    <div class="cabinet">
        
        <!-- Header -->
        <div class="scoreboard">
            <div class="score-box">
                <div class="score-label">CREDIT / ÈªûÊï∏</div>
                <div class="score-value" id="credit-display">500</div>
            </div>
            <div class="score-box">
                <div class="score-label">BET / ÊäºÂàÜ</div>
                <div class="score-value" id="bet-display">0</div>
            </div>
            <div class="score-box">
                <div class="score-label">WIN / ÂæóÂàÜ</div>
                <div class="score-value" id="win-display">0</div>
            </div>
        </div>

        <!-- Board -->
        <div class="game-board" id="board">
            <!-- Generated by JS -->
            <div class="center-panel">
                <div class="center-title">Â∞èÁë™Ëéâ<br><span style="font-size:0.8em; color:#aaa;">LITTLE MARY</span></div>
                <div class="message-log" id="message-log">WELCOME! PLACE BET.<br>Ë´ã‰∏ãÊ≥®</div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <!-- Symbol Betting Buttons -->
            <div class="bet-panel" id="bet-panel">
                <!-- Generated by JS -->
            </div>

            <!-- Game Actions -->
            <div class="action-row">
                <button class="btn-action btn-red" onclick="clearBet()">Clear<br>Ê∏ÖÈô§</button>
                <button class="btn-action btn-green" onclick="maxBet()">Max<br>ÂÖ®Êäº</button>
                <button class="btn-action btn-blue" id="start-btn" onclick="startGame()">START<br>ÈñãÂßã</button>
            </div>
        </div>

        <!-- Double Up Modal -->
        <div id="double-modal">
            <div class="modal-content">
                <h2>DOUBLE UP? / ÊØîÂ§ßÂ∞è</h2>
                <p>Current Win: <span id="double-current-win" style="color:#f1c40f">0</span></p>
                <div class="big-number" id="double-number">?</div>
                <p id="double-result-text"></p>
                
                <div class="double-btns" id="double-controls">
                    <button class="d-btn" style="background:#3498db; color:white;" onclick="playDouble('small')">SMALL (1-5)<br>Â∞è</button>
                    <button class="d-btn" style="background:#e74c3c; color:white;" onclick="playDouble('big')">BIG (6-10)<br>Â§ß</button>
                </div>
                <div class="double-btns" style="justify-content: center;">
                     <button class="d-btn" style="background:#2ecc71; color:white; width: 100%;" onclick="takeWin()">TAKE WIN / Êî∂ÂàÜ</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- GAME DATA CONFIGURATION ---
        // Symbols: Name, Multiplier, Icon, Weight (Frequency in the 24 slots)
        // Weights must sum to 24 for the board generation logic below to work perfectly.
        const symbolTypes = {
            'bar':    { name: 'BAR', mult: 100, icon: 'üíé', label: 'BAR' },
            'seven':  { name: '77', mult: 20, icon: '7Ô∏è‚É£', label: '77' },
            'star':   { name: 'Star', mult: 15, icon: '‚≠ê', label: 'Êòü' },
            'water':  { name: 'Watermelon', mult: 20, icon: 'üçâ', label: 'Ë•øÁìú' },
            'lemon':  { name: 'Lemon', mult: 15, icon: 'üçã', label: 'Ê™∏Ê™¨' },
            'bell':   { name: 'Bell', mult: 10, icon: 'üîî', label: 'Èêò' },
            'orange': { name: 'Orange', mult: 10, icon: 'üçä', label: 'Ê©ò' },
            'apple':  { name: 'Apple', mult: 5, icon: 'üçé', label: 'Ëòã' }
        };

        // The 24-slot board layout configuration (indices 0-23)
        const boardMap = [
            'orange', 'bell', 'bar', 'bell', 'orange', 'apple', 'apple', // 0-6 (Top)
            'lemon', 'seven', 'water', 'star', 'apple',             // 7-11 (Right)
            'orange', 'bell', 'lemon', 'apple', 'star', 'water', 'seven', // 12-18 (Bottom)
            'lemon', 'bell', 'orange', 'apple', 'apple'             // 19-23 (Left)
        ];

        // Ensure we have exactly 24 items
        const finalBoard = boardMap.slice(0, 24);

        // --- STATE VARIABLES ---
        let credits = 500;
        let currentBets = {}; // Object to store bets per symbol key
        let totalBet = 0;
        let currentWin = 0;
        let isSpinning = false;
        let activeIndex = 0; // Which LED is lit
        let audioCtx = null;

        // Initialize Bets
        Object.keys(symbolTypes).forEach(k => currentBets[k] = 0);

        // --- DOM ELEMENTS ---
        const boardEl = document.getElementById('board');
        const betPanelEl = document.getElementById('bet-panel');
        const creditEl = document.getElementById('credit-display');
        const betEl = document.getElementById('bet-display');
        const winEl = document.getElementById('win-display');
        const msgEl = document.getElementById('message-log');
        const doubleModal = document.getElementById('double-modal');

        // --- INITIALIZATION ---
        function init() {
            renderBoard();
            renderBetButtons();
            updateUI();
        }

        // Create the HTML Grid for the board
        function renderBoard() {
            // We need to place them in a CSS Grid 7x7
            // Perimeter calculation logic
            const posMap = [
                {r:1, c:1}, {r:1, c:2}, {r:1, c:3}, {r:1, c:4}, {r:1, c:5}, {r:1, c:6}, {r:1, c:7}, // Top 0-6
                {r:2, c:7}, {r:3, c:7}, {r:4, c:7}, {r:5, c:7}, {r:6, c:7}, // Right 7-11
                {r:7, c:7}, {r:7, c:6}, {r:7, c:5}, {r:7, c:4}, {r:7, c:3}, {r:7, c:2}, {r:7, c:1}, // Bottom 12-18
                {r:6, c:1}, {r:5, c:1}, {r:4, c:1}, {r:3, c:1}, {r:2, c:1} // Left 19-23
            ];

            finalBoard.forEach((key, index) => {
                const item = symbolTypes[key];
                const div = document.createElement('div');
                div.className = 'slot';
                div.id = `slot-${index}`;
                div.style.gridRow = posMap[index].r;
                div.style.gridColumn = posMap[index].c;
                
                div.innerHTML = `
                    <span class="icon">${item.icon}</span>
                    <span class="mult">x${item.mult}</span>
                `;
                boardEl.appendChild(div);
            });
        }

        // Create Betting Buttons
        function renderBetButtons() {
            // Order by logic (usually low to high or grouped)
            const order = ['apple', 'orange', 'lemon', 'bell', 'star', 'water', 'seven', 'bar'];
            
            order.forEach(key => {
                const item = symbolTypes[key];
                const btn = document.createElement('button');
                btn.className = 'bet-btn';
                btn.id = `btn-${key}`;
                btn.onclick = () => placeBet(key);
                btn.innerHTML = `
                    <span class="bet-icon">${item.icon}</span>
                    <span class="bet-label" style="font-size:0.6rem">${item.label}</span>
                    <span class="bet-amount" id="bet-val-${key}">0</span>
                `;
                betPanelEl.appendChild(btn);
            });
        }

        // --- AUDIO SYSTEM (Web Audio API) - ENHANCED ---
        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playSound(type) {
            if (!audioCtx) initAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            if (type === 'tick') {
                // Running light sound (Woodblock style)
                osc.type = 'square';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(100, now + 0.03);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.03);
                osc.start(now);
                osc.stop(now + 0.03);

            } else if (type === 'bet') {
                // Bet coin sound (High pitch ping)
                osc.type = 'sine';
                osc.frequency.setValueAtTime(1200, now);
                osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);

            } else if (type === 'start') {
                // Start spin sound (Power up)
                osc.type = 'square';
                osc.frequency.setValueAtTime(220, now);
                osc.frequency.linearRampToValueAtTime(880, now + 0.2);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);

            } else if (type === 'clear') {
                // Clear sound (Low cancel)
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.linearRampToValueAtTime(50, now + 0.15);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.15);
                osc.start(now);
                osc.stop(now + 0.15);

            } else if (type === 'win') {
                // Win fanfare (Major chord arpeggio)
                osc.type = 'triangle';
                // C Major Arpeggio
                osc.frequency.setValueAtTime(523.25, now); // C5
                osc.frequency.setValueAtTime(659.25, now + 0.1); // E5
                osc.frequency.setValueAtTime(783.99, now + 0.2); // G5
                osc.frequency.setValueAtTime(1046.50, now + 0.3); // C6
                
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0.1, now + 0.4);
                gain.gain.linearRampToValueAtTime(0, now + 0.6);
                
                osc.start(now);
                osc.stop(now + 0.6);

            } else if (type === 'lose') {
                // Lose sound (Sliding down)
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.linearRampToValueAtTime(50, now + 0.3);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            }
        }

        // --- GAME LOGIC ---

        function updateUI() {
            creditEl.textContent = credits;
            betEl.textContent = totalBet;
            winEl.textContent = currentWin;

            // Update individual bet badges
            Object.keys(currentBets).forEach(key => {
                const el = document.getElementById(`bet-val-${key}`);
                if (el) el.textContent = currentBets[key];
            });
        }

        function placeBet(key) {
            if (isSpinning) return;
            if (credits > 0) {
                credits--;
                currentBets[key]++;
                totalBet++;
                updateUI();
                playSound('bet'); // SOUND
            } else {
                log("No Credits! / ÈªûÊï∏‰∏çË∂≥");
            }
        }

        function clearBet() {
            if (isSpinning) return;
            if (totalBet === 0) return;
            
            // Return bets to credits
            credits += totalBet;
            totalBet = 0;
            Object.keys(currentBets).forEach(k => currentBets[k] = 0);
            updateUI();
            playSound('clear'); // SOUND
            log("Bets Cleared / Â∑≤Ê∏ÖÈô§");
        }

        function maxBet() {
            if (isSpinning) return;
            
            clearBet(); // First return everything
            
            const strategy = ['apple', 'orange', 'bell', 'lemon', 'star', 'water', 'seven', 'bar'];
            let added = 0;
            
            // Try to add up to 10 credits total distributed
            while (added < 10 && credits > 0) {
                 for (let s of strategy) {
                     if (credits > 0 && added < 10) {
                         credits--;
                         currentBets[s]++;
                         totalBet++;
                         added++;
                     }
                 }
            }
            updateUI();
            playSound('bet'); // SOUND
        }

        function log(text) {
            msgEl.innerHTML = text;
        }

        function startGame() {
            if (isSpinning) return;
            if (totalBet === 0) {
                log("Please Bet First! / Ë´ãÂÖà‰∏ãÊ≥®");
                return;
            }
            
            playSound('start'); // SOUND
            isSpinning = true;
            currentWin = 0;
            updateUI();
            log("Spinning... / Ë∑ëÁáà‰∏≠...");
            
            let speed = 50; // Start speed
            
            // Determine result beforehand (Weighted Random via Board Layout)
            const targetIndex = Math.floor(Math.random() * finalBoard.length);
            
            // Simple animation loop
            let stepCount = 0;
            
            function step() {
                // Highlight current
                document.getElementById(`slot-${activeIndex}`).classList.remove('active');
                activeIndex = (activeIndex + 1) % finalBoard.length;
                document.getElementById(`slot-${activeIndex}`).classList.add('active');
                playSound('tick'); // SOUND

                stepCount++;

                // Logic to simulate mechanical slowing down
                if (stepCount < 50) {
                    speed = 40;
                } else if (stepCount < 80) {
                    speed += 5;
                } else if (stepCount < 90) {
                    speed += 15;
                } else {
                    speed += 30;
                }

                // Stop condition: Slow enough AND Landed on target
                // Actually, arcade machines often pre-calculate. 
                // Let's just ensure we stop around the target index after minimum spins.
                
                // Simplified stop logic for smoother UX without complex math:
                // Just stop when speed is very slow.
                if (speed > 300 && stepCount > 60) {
                     finishSpin();
                     return;
                }
                
                setTimeout(step, speed);
            }
            
            step();
        }

        function finishSpin() {
            isSpinning = false;
            const symbolKey = finalBoard[activeIndex];
            const symbolData = symbolTypes[symbolKey];
            const betAmount = currentBets[symbolKey];
            
            // Calculate Win
            const winAmount = betAmount * symbolData.mult;
            
            if (winAmount > 0) {
                currentWin = winAmount;
                playSound('win'); // SOUND
                log(`<span style="color:yellow">WIN! ${symbolData.label} x${symbolData.mult}</span><br>Win: ${winAmount}`);
                updateUI();
                
                // Offer Double Up
                setTimeout(() => {
                    openDoubleModal();
                }, 1500);
                
            } else {
                log(`Result: ${symbolData.label}<br>No Bet. Try Again.`);
                // No win, game over for this round
            }
        }

        // --- DOUBLE UP LOGIC ---
        function openDoubleModal() {
            doubleModal.style.display = "flex";
            document.getElementById('double-current-win').textContent = currentWin;
            document.getElementById('double-number').textContent = "?";
            document.getElementById('double-result-text').textContent = "Choose Small (1-5) or Big (6-10)";
            document.getElementById('double-controls').style.display = 'flex';
        }

        function takeWin() {
            credits += currentWin;
            currentWin = 0;
            totalBet = 0;
            Object.keys(currentBets).forEach(k => currentBets[k] = 0);
            
            doubleModal.style.display = "none";
            updateUI();
            playSound('bet'); // Generic sound for taking coins
            log("Winner! Credits added.");
        }

        function playDouble(choice) {
            const controls = document.getElementById('double-controls');
            controls.style.display = 'none'; // Prevent double clicking
            
            const numDisplay = document.getElementById('double-number');
            
            // Animation effect
            let ticks = 0;
            const timer = setInterval(() => {
                numDisplay.textContent = Math.floor(Math.random() * 10) + 1;
                playSound('tick');
                ticks++;
                if(ticks > 10) {
                    clearInterval(timer);
                    resolveDouble(choice);
                }
            }, 100);
        }

        function resolveDouble(choice) {
            const result = Math.floor(Math.random() * 10) + 1;
            document.getElementById('double-number').textContent = result;
            
            const isSmall = result <= 5;
            const isBig = result >= 6;
            
            let won = false;
            if (choice === 'small' && isSmall) won = true;
            if (choice === 'big' && isBig) won = true;
            
            if (won) {
                currentWin = currentWin * 2;
                document.getElementById('double-current-win').textContent = currentWin;
                document.getElementById('double-result-text').textContent = "YOU WON! Double Again?";
                playSound('win'); // SOUND
                document.getElementById('double-controls').style.display = 'flex'; // Show buttons again
            } else {
                currentWin = 0;
                playSound('lose'); // SOUND
                document.getElementById('double-result-text').textContent = "YOU LOST. Bad luck.";
                
                setTimeout(() => {
                    doubleModal.style.display = "none";
                    credits += currentWin; // which is 0
                    totalBet = 0;
                    Object.keys(currentBets).forEach(k => currentBets[k] = 0);
                    updateUI();
                    log("Game Over.");
                }, 2000);
            }
        }

        // Start initialization
        init();

    </script>
</body>
</html>
